<fieldset class="responsive media">
  <legend class="caps-lock">Media</legend>
  
  <dl class="audio container">
    <dt>Audio</dt>  
    
    <!-- iterate item:media:audio -->
    <!-- insert views/forms/partials/audio.html -->
  </dl>
  
  <hr style="border-color:#5B9B98;opacity:0.5;"/>
  
  <dl class="images dnd container">
    <dt>Images</dt>
    <!-- iterate item:media:image -->
    <!-- insert views/forms/partials/image.html -->
  </dl>
  
  <hr class="clear"/>
  
  <button class="audio upload">Upload Audio</button>
  <button class="image upload">Upload Image</button>
  
  <script type="text/javascript">
    // <![CDATA[
    
    
    function startFormPlayer(audio_element) {
      var a = audio_element.parentNode.querySelector('a.button');
      a.style.display = 'inline-block';
      a.href = '#' + audio_element.dataset.index;
      a.addEventListener('click', function (evt) {
        evt.preventDefault();
        window.player.playTrack(Number(this.hash.substring(1)));
      });
      
      audio_element.parentNode.querySelector('input.mark').value = audio_element.duration;
    }
  
    bloc.prepare(function () {
      
    
      var uploader = new Upload('/manage/upload.xml', 'image/jpeg, image/jpg, audio/mp3, audio/mp4');
    
      uploader.addTrigger(document.querySelector('button.upload.image'));
      uploader.addTrigger(document.querySelector('button.upload.audio'));
      
      
      uploader.addRoutine('audio', function (file) {
        // make sure there is not a file currently associated with the feature
        this.progress = new Progress();
        var dd = document.querySelector('fieldset.media dl.audio').appendChild(document.createElement('dd'));
        dd.appendChild(this.progress.element);
      });
    
      uploader.addRoutine('image', function (file) {
        var reader = new FileReader();
    
        reader.onload = function (evt) {
          // this is the progress default holder thing.
          this.progress = new Progress();
          this.progress.element.style.backgroundImage = 'url('+evt.target.result+')';

          var dd = document.querySelector('fieldset.media dl.images').appendChild(document.createElement('dd'));
              dd.appendChild(this.progress.element);
              dd.className = "image";
        }.bind(this);
      
        reader.readAsDataURL(file);
      });
    
      uploader.addEvent('success', function (xhr) {
        var media = xhr.responseXML.documentElement.querySelector('dd.media');
        
        this.progress.element.parentNode.parentNode.replaceChild(media, this.progress.element.parentNode);

      });
      
      uploader.addEvent('failure', function (xhr) {
        console.error(xhr.responseText, 'undo some stuff');
        window.alert(xhr.responseText);
        this.progress.element.parentNode.removeChild(this.progress.element);
        
      });
      
      sortable('dl.images.dnd', 'dd');
    });
  //]]>
  </script>
  
  
</fieldset>