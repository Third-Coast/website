<nav>
  <a href="[/$paginate:prefix/$paginate:previous]">Prev</a>
  <em>[$paginate:index of $paginate:total]</em>
  <a href="[/$paginate:prefix/$paginate:next]">Next</a>
  <input type="range" min="1" max="[$paginate:total]" value="[$paginate:index]" step="1" onchange="[window.location.href = '/$paginate:prefix/'+this.value;]" oninput="this.parentNode.querySelector('em').innerHTML = 'Go to page ' + this.value"/>
  <form action="[/search/$search:topic/]" id="search" data-redirect="/explore/edit/">
    <input type="search" name="search" placeholder="[search $search:topic]"/>
  </form>
  <script type="text/javascript">
    // <![CDATA[
      bloc.prepare(function () {
        var search = document.getElementById('search');
        var request = new XMLHttpRequest();
        var alphanumeric  = /[a-z0-9]{1}/i;
        var catalog       = null;
        var halt          = false;
        var searchbox = search.querySelector('input');
        var results = search.appendChild(document.createElement('ul'));
        
        request.onreadystatechange = function (response) {
          if (request.readyState === 1) {
            catalog = null;
          }
          if (request.readyState === 4 && request.status === 200) {
            catalog = JSON.parse(request.responseText) || {};
            halt = false;
          }
        };
        
        searchbox.addEventListener('keydown', function (evt) {
          // 
          var letter = String.fromCharCode(evt.keyCode);
          if (alphanumeric.test(letter) && this.value.length === 0) {
            halt = true;
            request.open('GET', search.action + letter + '.json');
            request.send();
          }
        });
        
        searchbox.addEventListener('keyup', function (evt) {
          if (halt === null) return;
          
          var new_element = results.cloneNode();    
          results.parentNode.replaceChild(new_element, results);
          results = new_element;
          
          var term = this.value;
          var match_re = new RegExp(term.toLowerCase().replace(/[&+]/g, 'and').replace(/[\s.,"':?#\[\]\(\)\-]*/g, ''), 'i');
          var item_re = new RegExp("("+term+")", 'i');
          var count = 0;
          for (var key in catalog) {
            
            if (match_re.test(key)) {
              var li = document.createElement('li');
              var a = document.createElement('a');
              li.appendChild(a);
              results.appendChild(li);
              console.log(catalog[key][0]);
              a.href = search.dataset.redirect + catalog[key][0];
              a.innerHTML = catalog[key][1].replace(item_re, "<strong>$1</strong>");
              
              if (++count >= 10) break;
            }
          }
          return;
          for (var i = 0; i < this.items.length; i++) {
            var key = this.indices[i];
           
          }
          
        });
        
        

      });
    // ]]>
  </script>
</nav>