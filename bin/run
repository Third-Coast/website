#!/usr/bin/env php
<?php

namespace bloc;

date_default_timezone_set ('America/Chicago');

#1. Frow where index.php is located, load the application file. This is the only mandatory part I think.
require_once  '../bloc/application.php';


#2. Create an instance of the application
$app = new Application;


# main page deal#!/usr/bin/env php
$app->prepare('command', function ($app) {
  
  $params = $_SERVER['argv'];
  $script   = array_shift($params);

  // an ugly one-liner. turns a.b into ['controller'=>'a', 'action'=>'b'], or null if not provided
  $delegate = array_combine(['controller', 'action'], array_filter(preg_split('/\W+/', trim(array_shift($params)))) ?: [null,null]);
  
  // request expects array of this form [controller=>string,action=>string,params=[]]
  $request = new Request(array_merge($delegate, ['params' => $params]), false);
  
  // Provide a namespace (also a directory) to load objects that can respond to controller->action
  $router  = new Router('controllers', $request);
  
  // default controller and action as arguments, in case nothin doin in the request
  $view = $router->delegate('manage', 'index');
  echo $view;
  return true;
});



$app->execute('command');
